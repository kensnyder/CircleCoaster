(function(global){"use strict";function CircleCoaster(){this.initialize.apply(this,[].slice.call(arguments))}CircleCoaster.isSupported=function isSupported(){var style=document.createElement("div").style;return typeof style.animation!="undefined"||typeof style.webkitAnimation!="undefined"};CircleCoaster.defaultOptions={size:32,speed:1.25,dots:5,color:"#666666",angles:[-82,-70,-56,-38,-8,30,70,105,128,145,157,169,181,193,205,217,229,241,253,265,-82],cssTpl:".cc-spinner-{{spec}} {\n  width: {{size}}px;\n  height: {{size}}px;\n  position: relative;\n  display: inline-block;\n}\n.cc-spinner-{{spec}} .cc-dot {\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: {{dotSize}}px;\n  width: {{dotSize}}px;\n  border-radius: {{dotRadius}}px;\n  background-color: {{color}};\n  transform: translate({{startX}}px, {{startY}}px);\n  -webkit-transform: translate({{startX}}px, {{startY}}px);\n  animation: cc-{{spec}} {{speed}}s linear 0s infinite;\n  -webkit-animation: cc-{{spec}} {{speed}}s linear 0s infinite;\n}\n{{#each dots}}.cc-spinner-{{spec}} .cc-dot{{idx}} {\n  animation-delay: {{delay}}ms;\n  -webkit-animation-delay: {{delay}}ms;\n}\n{{/each}}",htmlTpl:'<div class="cc-spinner cc-spinner-{{spec}}">\n{{#each dots}}  <div class="cc-dot cc-dot{{idx}}"></div>\n{{/each}}</div>'};function extend(){var p,d=arguments[0];for(var i=1,len=arguments.length;i<len;i++){for(p in arguments[i]){if(arguments[i].hasOwnProperty(p)){d[p]=arguments[i][p]}}}return d}CircleCoaster.prototype={initialize:function initialize(options){this.options=extend({},CircleCoaster.defaultOptions,options||{});this.spec=this._getSpec();this.keyframes=this._buildKeyframes();this.htmlBuilder=this._compile(this.options.htmlTpl);this.cssBuilder=this._compile(this.options.cssTpl)},_getSpec:function _getSpec(){return[this.options.size,this.options.speed,this.options.dots,this.options.color.replace("#","")].join("-").replace(/[^\w-]+/g,"_")},_buildKeyframes:function _buildKeyframes(){var sizeSansDot=this.options.size-Math.ceil(this.options.size/9);var lines=[];var rad=Math.PI/180;var interval=100/(this.options.angles.length-1);var a,x,y;for(var i=0;i<this.options.angles.length;i++){a=this.options.angles[i];x=(sizeSansDot/2*Math.cos(a*rad)+sizeSansDot/2).toFixed(1);y=(sizeSansDot/2*Math.sin(a*rad)+sizeSansDot/2).toFixed(1);lines.push("  "+this._calcPrecision(i*interval)+"% { transform: translate("+x+"px, "+y+"px); }")}lines.unshift("@keyframes cc-"+this.spec+" {");lines.push("}");var css=lines.join("\n");css+="\n"+css.replace(/@keyframes/g,"@-webkit-keyframes").replace(/transform/g,"-webkit-transform");return{css:css,startX:x,startY:y}},_calcPrecision:function _calcPrecision(n){if(n%1!==0){return n.toFixed(2)}return String(n)},_compile:function _compile(s){var uid=0;s=s.replace(/\n/g,"\\n\\\n");s=s.replace(/\{\{#each ([\w_]+)\}\}([\s\S]*?)\{\{\/each\}\}/g,function($a0,$a1,$a2){return"';\nfor (var i# = 0, len# = (data."+$a1+" || []).length; i# < len#; i#++) {\n  out += '"+$a2.replace(/\{\{([\w_]+)\}\}/g,function($b0,$b1){return"' + (data."+$a1+"[i#]."+$b1+" || data."+$b1+") + '"})+"';\n}\nout += '"}).replace(/#/g,++uid);s=s.replace(/\{\{([\w_]+)\}\}/g,function($a0,$a1){return"' + data."+$a1+" + '"});s='var out = "";\nout += \''+s+"';\nreturn out;";return new Function("data",s)},generateHtml:function generateHtml(){var dots=[];for(var i=0;i<this.options.dots;i++){dots[i]={idx:i+1}}return this.htmlBuilder({spec:this.spec,dots:dots})},generateCss:function generateCss(){var dots=[];for(var i=0;i<this.options.dots;i++){dots[i]={idx:i+1,delay:Math.round(this.options.speed*100*(i+1))}}return this.keyframes.css+"\n"+this.cssBuilder({spec:this.spec,size:this.options.size,speed:this.options.speed,color:this.options.color,dotSize:Math.ceil(this.options.size/9),dotRadius:Math.ceil(Math.ceil(this.options.size/9)/2),startX:this.keyframes.startX,startY:this.keyframes.startY,dots:dots})},appendStyleElement:function appendStyleElement(){var id="cc-style-"+this.spec;if(document.getElementById(id)){return}var style=document.createElement("style");style.setAttribute("type","text/css");style.setAttribute("id",id);style.textContent=this.generateCss();(document.body||document.getElementsByTagName("body")[0]).appendChild(style);return style},inject:function inject(toElement){this.appendStyleElement();toElement.innerHTML=this.generateHtml();return this},append:function append(toElement){this.appendStyleElement();var div=document.createElement("div");div.innerHTML=this.generateHtml();toElement.appendChild(div.firstChild);return this},remove:function remove(fromElement){[].forEach.call((fromElement||document).querySelectorAll("cc-spinner-"+this.spec),function(el){el.parentNode.removeChild(el)});return this}};if(window.jQuery&&window.jQuery.fn){jQuery.fn.circleCoaster=function(options){var cc=new CircleCoaster(options);this.each(function injectIntoEachNode(){(options.append?cc.append:cc.inject).call(cc,this)});return this};jQuery.CircleCoaster=CircleCoaster}global.CircleCoaster=CircleCoaster})(window);